(() => {

  const osfLogo = `<a href="https://opensourceforce.net" target="_blank">
  <svg x="30%" y="30%" width="40%" height="40%" viewBox="0 0 200 240">
                <!-- Shield base -->
  <path d="M100 10 L190 60 L190 180 L100 230 L10 180 L10 60 Z" fill="#4a80b5" stroke="#2c4b6e" stroke-width="5"></path>
  
  <!-- Silver border -->
  <path d="M100 20 L180 65 L180 175 L100 220 L20 175 L20 65 Z" fill="none" stroke="#c0c0c0" stroke-width="8"></path>
  
  <!-- Red design -->
  <path d="M100 40 L160 75 L160 165 L100 200 L40 165 L40 75 Z" fill="#9e2020"></path>
  
  <!-- Arch Linux inspired logo -->
  <path d="M100 70 L130 130 H70 Z" fill="none" stroke="#1793d1" stroke-width="8" stroke-linejoin="round"></path>
  <circle cx="100" cy="115" r="4" fill="#1793d1"></circle>
  
  <!-- Wing designs -->
  <path d="M60 140 Q80 130 100 140 Q120 130 140 140" fill="none" stroke="#c0c0c0" stroke-width="5"></path>
  <path d="M70 155 Q85 145 100 155 Q115 145 130 155" fill="none" stroke="#c0c0c0" stroke-width="5"></path>
  <defs>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2.5" result="coloredBlur"></feGaussianBlur>
      <feMerge>
        <feMergeNode in="coloredBlur"></feMergeNode>
        <feMergeNode in="SourceGraphic"></feMergeNode>
      </feMerge>
    </filter>
  </defs>
  
  <path id="bolt3012" fill="none" d="M60 30 L69 38 L60 45 L69 64 L62 115 L30 200" stroke="#f2d51e" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" opacity="0" filter="url(#glow)">
    <animate id="drawBolt3012" attributeName="stroke-dasharray" from="0 300" to="300 300" begin="0" dur="0.3s" fill="remove"></animate>
    <animate attributeName="opacity" from="0" to="1" dur="0.3s" begin="0" fill="freeze"></animate>
  </path>

 
  <path id="boltLine3012" fill="none" d="M60 30 L69 38 L60 45 L69 64 L62 115 L30 200" stroke="#ffffff" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" opacity="0">
    <animate attributeName="stroke-dasharray" from="0 300" to="300 300" begin="0" dur="0.3s" fill="freeze"></animate>
    <animate attributeName="opacity" from="0" to="1" dur="0.3s" begin="0" fill="freeze"></animate>

  </path>

<animate xlink:href="#bolt3012" attributeName="opacity" from="1" to="0" begin="drawBolt3012.end" dur="0.2s" fill="freeze"></animate>

<animate xlink:href="#boltLine3012" attributeName="opacity" from="1" to="0" begin="drawBolt3012.end" dur="0.2s" fill="freeze"></animate>
  <defs>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2.5" result="coloredBlur"></feGaussianBlur>
      <feMerge>
        <feMergeNode in="coloredBlur"></feMergeNode>
        <feMergeNode in="SourceGraphic"></feMergeNode>
      </feMerge>
    </filter>
  </defs>
  
  <path id="bolt62727" fill="none" d="M120 30 L123 37 L120 68 L123 75 L120 81 L123 102 L120 115 L100 200" stroke="#f2d51e" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" opacity="0" filter="url(#glow)">
    <animate id="drawBolt62727" attributeName="stroke-dasharray" from="0 300" to="300 300" begin="2" dur="0.3s" fill="remove"></animate>
    <animate attributeName="opacity" from="0" to="1" dur="0.3s" begin="2" fill="freeze"></animate>
  </path>

 
  <path id="boltLine62727" fill="none" d="M120 30 L123 37 L120 68 L123 75 L120 81 L123 102 L120 115 L100 200" stroke="#ffffff" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" opacity="0">
    <animate attributeName="stroke-dasharray" from="0 300" to="300 300" begin="2" dur="0.3s" fill="freeze"></animate>
    <animate attributeName="opacity" from="0" to="1" dur="0.3s" begin="2" fill="freeze"></animate>

  </path>

<animate xlink:href="#bolt62727" attributeName="opacity" from="1" to="0" begin="drawBolt62727.end" dur="0.2s" fill="freeze"></animate>

<animate xlink:href="#boltLine62727" attributeName="opacity" from="1" to="0" begin="drawBolt62727.end" dur="0.2s" fill="freeze"></animate>
  <defs>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2.5" result="coloredBlur"></feGaussianBlur>
      <feMerge>
        <feMergeNode in="coloredBlur"></feMergeNode>
        <feMergeNode in="SourceGraphic"></feMergeNode>
      </feMerge>
    </filter>
  </defs>
  
  <path id="bolt14256" fill="none" d="M250 30 L266 67 L246 91 L260 120 L256 142 L272 159 L160 200" stroke="#f2d51e" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" opacity="0" filter="url(#glow)">
    <animate id="drawBolt14256" attributeName="stroke-dasharray" from="0 300" to="300 300" begin="4" dur="0.3s" fill="remove"></animate>
    <animate attributeName="opacity" from="0" to="1" dur="0.3s" begin="4" fill="freeze"></animate>
  </path>

 
  <path id="boltLine14256" fill="none" d="M250 30 L266 67 L246 91 L260 120 L256 142 L272 159 L160 200" stroke="#ffffff" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" opacity="0">
    <animate attributeName="stroke-dasharray" from="0 300" to="300 300" begin="4" dur="0.3s" fill="freeze"></animate>
    <animate attributeName="opacity" from="0" to="1" dur="0.3s" begin="4" fill="freeze"></animate>

  </path>

<animate xlink:href="#bolt14256" attributeName="opacity" from="1" to="0" begin="drawBolt14256.end" dur="0.2s" fill="freeze"></animate>

<animate xlink:href="#boltLine14256" attributeName="opacity" from="1" to="0" begin="drawBolt14256.end" dur="0.2s" fill="freeze"></animate>
  <defs>
    <linearGradient id="silverGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#C0C0C0"></stop>
      <stop offset="50%" stop-color="#FFF"></stop>
      <stop offset="100%" stop-color="#C0C0C0"></stop>
      <animate attributeName="x1" values="-100%;0%;100%" dur="3s" repeatCount="indefinite"></animate>
      <animate attributeName="x2" values="0%;100%;200%" dur="3s" repeatCount="indefinite"></animate>
    </linearGradient>
  </defs>
  
  <text x="30" y="200" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="url(#silverGradient)" stroke="#A9A9A9" stroke-width="1" opacity="0">
    OPEN
    <animate attributeName="opacity" values="0;1" begin="0.3s" dur="0.2s" fill="freeze"></animate>
  </text>

  <text x="90" y="200" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="url(#silverGradient)" stroke="#A9A9A9" stroke-width="1" opacity="0">
    SOURCE
    <animate attributeName="opacity" values="0;1" begin="2.2s" dur="0.2s" fill="freeze"></animate>
  </text>

  <text x="160" y="200" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="url(#silverGradient)" stroke="#A9A9A9" stroke-width="1" opacity="0">
    FORCE
    <animate attributeName="opacity" values="0;1" begin="4.2s" dur="0.2s" fill="freeze"></animate>
  </text>


              </svg>
</a>`;




  const getAllStyles = () => {
    let styles = [];
    
    Array.from(document.getElementsByTagName('style')).forEach(styleSheet => {
        Array.from(styleSheet.sheet.cssRules).forEach(rule => {
            styles.push(rule.cssText);
        });
    });
    
/*    Array.from(document.styleSheets).forEach(styleSheet => {
        try {
            Array.from(styleSheet.cssRules || styleSheet.rules).forEach(rule => {
                styles.push(rule.cssText);
            });
        } catch (e) {
            // CORS might prevent accessing some external stylesheets
            console.log('Could not access:', styleSheet.href);
        }
    });*/
    
    return styles.join('\n');
  };

  const openDoors = () => {
    const windowLeftWidth = Math.floor(window.innerWidth / 2);
    const windowRightWidth = Math.ceil(window.innerWidth / 2);
    const windowHeight = window.innerHeight;
    console.log(document.body);

    const leftDiv = document.createElement("div");
    const rightDiv = document.createElement("div");

    const left = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    const right = document.createElementNS("http://www.w3.org/2000/svg", "svg");

    left.setAttribute("x", "0");
    left.setAttribute("y", "0");
    left.setAttribute("width", `${window.innerWidth}`);
    left.setAttribute("height", `${windowHeight}`);
    right.setAttribute("style", "margin: 0; padding: 0;");
    leftDiv.setAttribute("style", `position: absolute; left: 0; top: 0; width: ${window.innerWidth}px;  height: ${windowHeight}px; margin:0;padding:0;overflow:hidden;background-color:transparent;`);

    right.setAttribute("x", `${-windowLeftWidth}`);
    right.setAttribute("y", "0");
    right.setAttribute("width", `${window.innerWidth}`);
    right.setAttribute("height", `${windowHeight}`);
    right.setAttribute("style", "margin: 0; padding: 0;");
    rightDiv.setAttribute("style", `position:absolute;left:${windowLeftWidth}px;top:0;width:${window.innerWidth}px;height:${windowHeight}px;margin:0;padding:0;`);

    // Create defs elements
    const leftDefs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
    const rightDefs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');

    // Create clipPath elements
    const leftClipPath = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');
    const rightClipPath = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');

    // Set clipPath IDs
    leftClipPath.setAttribute('id', 'leftClipPath');
    rightClipPath.setAttribute('id', 'rightClipPath');

    // Create rect elements
    const leftRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    const rightRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');

    // Set rect attributes
    leftRect.setAttribute('x', '0');
    leftRect.setAttribute('y', '0');
    leftRect.setAttribute('width', windowLeftWidth);
    leftRect.setAttribute('height', windowHeight);

//    rightRect.setAttribute('x', windowRightWidth);
    rightRect.setAttribute('x', '0');
    rightRect.setAttribute('y', '0');
    rightRect.setAttribute('width', windowRightWidth);
    rightRect.setAttribute('height', windowHeight);

    // Build the structure
    leftClipPath.appendChild(leftRect);
    rightClipPath.appendChild(rightRect);
    leftDefs.appendChild(leftClipPath);
    rightDefs.appendChild(rightClipPath);

    left.innerHTML = 
      `<defs>
         <mask id="leftMask">
                <rect x="0" y="0" width="1187" height="693" fill="white"/>
                <rect x="593" y="0" width="594" height="693" fill="black"/>
            </mask>
       </defs>
      <g mask="url(#leftMask)">
      <foreignObject width="${window.innerWidth}" height="${window.innerHeight}">
        <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%;">
        <style>
          ${getAllStyles()}
        </style>
        ${document.body.innerHTML}
        </div>
      </foreignObject>
      </g>`;
    right.innerHTML = 
      `<foreignObject x=${-windowLeftWidth} width="${window.innerWidth}" height="${window.innerHeight}" clip-path="url(#rightClipPath)">
        <div xmlns="http://www.w3.org/1999/xhtml" style="width: 100%; height: 100%;">
        <style>
          ${getAllStyles()}
        </style>
        ${document.body.innerHTML}
        </div>
      </foreignObject>`;

    // Add to SVGs
    //left.appendChild(leftDefs);
    right.appendChild(rightDefs);

  console.log(left.innerHTML);
  console.log(left);

    let slideLeft = 0;
    let slideRight = windowLeftWidth; 

    const slideOut = () => {
console.log('are we slidin\'');
      slideLeft -= 2;
      slideRight += 2;
      leftDiv.style.left = `${slideLeft}px`;
      rightDiv.style.left = `${slideRight}px`;
console.log(slideLeft, 'slideLeft');
console.log(slideRight, 'slideRight');
console.log(window.innerWidth - 100);
     
      if(slideLeft < 100 - window.innerWidth || slideRight > window.innerWidth - 100) {
        return;
      }

      requestAnimationFrame(slideOut);
/*      const leftAnimation = document.createElementNS("http://www.w3.org/2000/svg", "animateMotion");
      leftAnimation.setAttribute("dur", "1000ms");
      leftAnimation.setAttribute("repeatCount", "1");
      leftAnimation.setAttribute("path", `M 0,0 L ${-(leftWindowWidth - 100)},0`);
      leftAnimation.setAttribute("fill", "freeze");

      const rightAnimation = document.createElementNS("http://www.w3.org/2000/svg", "animateMotion");
      leftAnimation.setAttribute("dur", "1000ms");
      leftAnimation.setAttribute("repeatCount", "1");
      leftAnimation.setAttribute("path", `M 0,0 L ${rightWindowWidth - 100},0`);
      leftAnimation.setAttribute("fill", "freeze");

      left.appendChild(leftAnimation);
      right.appendChild(rightAnimation); */
    };

    left.addEventListener('click', () => requestAnimationFrame(slideOut));
    right.addEventListener('click', () => requestAnimationFrame(slideOut));

    leftDiv.appendChild(left);
    rightDiv.appendChild(right);

    const osfDiv = document.createElement('div');
    osfDiv.style = "z-index: -1;width:200px;height:200px;background-color:green;margin: 5em auto;padding: 2em;";
    osfDiv.innerHTML = 
      `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 240">
        ${osfLogo}
       </svg>`;

    document.body.innerHTML = '';
    document.body.append(osfDiv);
    document.body.appendChild(leftDiv);
    document.body.appendChild(rightDiv);
    window.removeEventListener('click', openDoors);
  };

  window.addEventListener('click', openDoors);
})();
